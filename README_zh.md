# MemorySpaceExplorer 🚀

**MemorySpaceExplorer** 是一款专为 Windows 打造的高性能物理内存与 NVIDIA 显存可视化分析及优化工具。它采用 **矩形树图 (TreeMap)** 布局，为您提供直观、清晰的系统资源分配视图。

## 🖼 截图展示

| 主界面 (中文) | 主界面 (英文) |
| :---: | :---: |
| ![中文界面](./pics/image%20zh.png) | ![英文界面](./pics/image%20en.png) |

| 折叠式设置面板 |
| :---: |
| ![设置页面](./pics/image%20setting.png) |

**简体中文** | [English](./README.md)

---

## ✨ 核心特性

### 📊 可视化资源分析
- **矩形树图可视化**: 采用高性能 Squarified Treemap 算法，动态展示物理内存、交换区和显存占用。
- **进程内部透视**: 每一个进程色块内部都会细分为 **[物理内存 | 虚拟内存]** 两个子区域，并以不同颜色（蓝/橙）标识，直观展示内存构成。
- **双查看模式**:
  - **程序模式**: 自动聚合同一应用（如 Chrome 标签页、VS Code 插件）的所有子进程，快速定位内存大户。
  - **独立进程模式**: 展示每个 PID 的精确占用。

### 🎮 游戏与性能
- **游戏模式 (自动避让)**: 智能检测全屏/无边框游戏运行。当检测到游戏时，程序会自动进入“休眠”状态（刷新率降至 30s），停止繁重的监控逻辑以确保游戏帧率不受干扰。激活时热力图右下角会显示 🎮 图标。
- **单实例保护**: 采用 Local Server 机制确保全局只有一个程序实例运行，避免资源冲突。
- **动态托盘图标**: 托盘图标包含 4 条实时动态柱状图：
  - **左侧 2 条**: 物理内存占用百分比。
  - **右侧 2 条**: GPU 显存占用百分比。
- **智能内存优化**: 利用 Windows Working Set API 周期性释放闲置进程占用的物理内存。

### 🛠 高级管理功能
- **精确显存追踪**: 结合 `pynvml`、`nvidia-smi` 和 Windows 性能计数器，通过 **LUID 硬件 ID 匹配** 准确识别进程级显存占用（完美支持多显卡环境）。
- **CPU 亲和性管理**: 记录并自动应用进程的 CPU 核心绑定设置，适合对特定程序进行性能限制或优化。
- **进程链分析**: 右键即可查看进程的“祖先”与“子孙”关系链，理清复杂的进程树。

### 🎨 现代 UI 与体验
- **折叠式设置面板**: 采用现代化的折叠 UI 管理海量配置项，保持界面清爽。
- **实时搜索与过滤**: 在详细列表页快速查找特定进程。
- **自定义主题**: 自由调整系统内存、GPU 内存、虚拟内存及可用空间的显示颜色。
- **多语言治理 (I18N)**: 完整支持中英文即时切换，所有界面文本集中管理。
- **安全配置存储**: 配置文件存放在用户系统的 `Documents\MemorySpaceExplorer` 文件夹下，符合 Windows 规范且无权限隐患。

---

## 🖥 系统要求
- **操作系统**: Windows 10/11
- **Python 环境**: 3.8+
- **硬件**: NVIDIA GPU（用于显存监控功能）。

---

## 💾 获取程序

### 1. 直接下载 (推荐)
您可以直接从项目的 `dist` 目录下载已经构建好的可执行文件，无需安装 Python 环境：
- 📥 **[下载 MemoryUitl.exe](./dist/MemoryUitl.exe)**

### 2. 源码运行
如果您希望从源码运行，请参考下方的安装步骤。

---

## 📦 安装步骤

1. **获取代码**
   ```bash
   git clone https://github.com/yourusername/memory_anaylize_tool.git
   cd memory_anaylize_tool
   ```

2. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```
   *(必要依赖: `PyQt6`, `psutil`, `pynvml`)*

---

## 🛠 使用说明

1. **运行程序**
   ```bash
   python main.py
   ```
2. **交互操作**:
   - **左键双击**: 查看聚合组的详细进程列表。
   - **右键单击**: 打开管理菜单（定位文件、结束进程、CPU 亲和性）。
   - **托盘图标**: 悬停查看简报，右键快速操作。

---

## ❓ 常见问题排查 (Troubleshooting)

### 1. 运行报错：`TypeError: argument 1 has unexpected type 'QPoint'`
这是由于 PyQt6 对 `contains()` 方法的类型检查非常严格。
- **解决方法**: 
  - 如果您是**开发者**: 请确保已拉取最新代码。我已经将所有的 `QPoint` 显式转换为了 `QPointF`。
  - **清除缓存**: 删除项目中的 `__pycache__` 文件夹。
  - **重新打包**: 如果您运行的是 EXE，请务必执行 `pyinstaller --clean MemoryUitl.spec` 重新生成。

### 2. GPU 显存显示为 0 或无法识别进程
- **解决方法**: 
  - 请确保安装了 NVIDIA 驱动。
  - 尝试以 **管理员身份** 运行程序。
  - 检查系统中是否存在 `nvidia-smi` 命令。

---

## 🏗 自行打包为 EXE

如果您修改了代码并希望自行生成 EXE 文件，请按照以下步骤操作：

1. **安装 PyInstaller**:
   ```bash
   pip install pyinstaller
   ```

2. **执行打包命令 (推荐使用 Spec 文件)**:
   ```bash
   pyinstaller --clean MemoryUitl.spec
   ```
   *(注：由于项目已进行模块化拆分，直接打包 `main.py` 可能会导致缺少模块。使用 `.spec` 文件可确保所有子文件夹都被正确包含。)*

3. **版本信息**: 
   您可以编辑 `file_version_info.txt` 来修改生成的 EXE 属性（如版权、版本号等）。

---

## 📂 项目结构

项目经过重构，采用了模块化设计以提高可维护性：
- `main.py`: 应用程序入口及主窗口。
- `config.py`: 多语言治理 (I18N) 及全局配置管理。
- `ui/`: 包含所有 UI 组件和对话框。
- `utils/`: 包含核心布局算法、数据采集逻辑及系统辅助工具。

---

## 💡 提示
- **管理员权限**: 建议以管理员身份运行，以获取完整的进程信息并实现深度内存优化。
- **显存方案自适应**: 程序会根据环境自动选择最佳方案（NVML > XML > CSV > PowerShell）进行显存监控。

---

## ⚖ 开源协议
MIT License

